<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kerala Quest - The Ultimate Calicut Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            touch-action: pan-x pan-y;
            overflow: hidden; 
        }

        /* Specific Kerala Themes */
        .kerala-gradient {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
        }
        
        /* Glassmorphism that works on dark/light */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* Responsive Container - Mobile First, expands on Desktop */
        .app-container {
            width: 100%;
            height: 100dvh;
            background: #f8fafc;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Desktop specific refinements */
        @media (min-width: 768px) {
            .app-container {
                max-width: 1600px; /* Max width for huge screens */
                margin: 0 auto;
                box-shadow: 0 0 50px rgba(0,0,0,0.5);
            }
            
            /* Custom Scrollbar for desktop content areas */
            .desktop-scroll::-webkit-scrollbar {
                width: 8px;
            }
            .desktop-scroll::-webkit-scrollbar-track {
                background: #f1f1f1; 
            }
            .desktop-scroll::-webkit-scrollbar-thumb {
                background: #cbd5e1; 
                border-radius: 4px;
            }
            .desktop-scroll::-webkit-scrollbar-thumb:hover {
                background: #94a3b8; 
            }
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }

        /* Scrollbar hiding for mobile horizontal scrolls */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex justify-center items-center h-screen bg-gray-900 md:p-4">

    <div class="app-container md:rounded-2xl transition-all duration-300" id="app">
        <!-- SPLASH SCREEN INITIALLY -->
        <div id="splash" class="absolute inset-0 z-50 kerala-gradient flex flex-col items-center justify-center text-white">
            <i class="fas fa-compass text-6xl mb-4 animate-float"></i>
            <h1 class="text-4xl font-bold tracking-tighter">Kerala Quest</h1>
            <p class="text-emerald-100 mt-2 tracking-widest text-sm uppercase">God's Own Game</p>
            <div class="mt-8 w-48 h-1 bg-white/30 rounded-full overflow-hidden">
                <div class="h-full bg-white animate-[pulse_1.5s_infinite]"></div>
            </div>
            <p class="absolute bottom-8 text-xs opacity-70">Detecting Region...</p>
        </div>
    </div>

    <script>
        // --- DATA & STATE MANAGEMENT ---
        
        const HOTSPOTS = [
            { 
                id: 'calicut', 
                name: "Calicut Beach", 
                district: "Kozhikode", 
                desc: "The historic pier & sweets street.", 
                img: "linear-gradient(to right, #4facfe 0%, #00f2fe 100%)",
                games: ["Pier Treasure Hunt", "Halwa Run AR"]
            },
            { 
                id: 'marine', 
                name: "Marine Drive", 
                district: "Kochi", 
                desc: "The Queen of the Arabian Sea.", 
                img: "linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%)",
                games: ["Rainbow Bridge Puzzle", "Backwater Boat Race"]
            },
            { 
                id: 'varkala', 
                name: "Varkala Cliff", 
                district: "Trivandrum", 
                desc: "Red cliffs and golden sands.", 
                img: "linear-gradient(to top, #fcc5e4 0%, #fda34b 15%, #ff7882 35%, #c8699e 52%, #7046aa 71%, #0c1db8 87%, #020f75 100%)",
                games: ["Cliffside Mystery", "Surfer's Challenge"]
            },
            { 
                id: 'fortkochi', 
                name: "Fort Kochi", 
                district: "Kochi", 
                desc: "Colonial history & fishing nets.", 
                img: "linear-gradient(to top, #30cfd0 0%, #330867 100%)",
                games: ["Colonial Ghost Hunt", "Spice Route Quiz"]
            }
        ];

        const QUESTS = {
            'calicut': [
                { 
                    id: 1, 
                    level: 1,
                    title: "The Broken Bridge",
                    riddle: "I stand tall specifically in the evening sun, broken but loved by everyone. Find the pillar marked with the year of independence.",
                    code: "1947",
                    points: 500,
                    hint: "Look near the ice pickle sellers.",
                    locked: false
                },
                { 
                    id: 2, 
                    level: 2,
                    title: "Sweet Street",
                    riddle: "Where the air smells of ghee and red blocks of joy. Find the oldest Halwa shop sign.",
                    code: "HALWA",
                    points: 750,
                    hint: "It's on SM Street.",
                    locked: true
                }
            ],
            'marine': [
                {
                    id: 3,
                    level: 1,
                    title: "The Rainbow Arc",
                    riddle: "I arch over the water but cars cannot cross me. Count the black tiles at my base.",
                    code: "42",
                    points: 500,
                    hint: "Marine Drive Walkway Bridge.",
                    locked: false
                }
            ],
            'varkala': [ { id: 4, level: 1, title: "Cliffhanger", riddle: "Find the red rock.", code: "RED", points: 500, locked: false } ],
            'fortkochi': [ { id: 5, level: 1, title: "Net Catcher", riddle: "Chinese nets need Chinese weights.", code: "STONE", points: 500, locked: false } ]
        };

        const BADGES = [
            { name: "Beach Bum", icon: "üèñÔ∏è", desc: "Visited Calicut Beach" },
            { name: "Team Player", icon: "ü§ù", desc: "Joined a Squad" },
            { name: "Navigator", icon: "üß≠", desc: "Found 5 locations" }
        ];

        // Global State
        const state = {
            view: 'splash', // splash, login, location-select, admin, volunteer, player
            subView: 'permission', // permission, list
            user: { role: null, name: 'Guest', points: 1250, badges: [BADGES[0]], selectedLocation: null, teamStatus: 'solo' },
            activeTab: 'home', // home, social, profile, leaderboard
            game: { active: false, score: 0, lives: 3, interval: null },
            chat: { open: false, partner: null, messages: [] },
            players: [
                { id: 1, name: "Adnan", status: "public", team: "looking", dist: "10m", avatar: "üßî", lvl: 5 },
                { id: 2, name: "Riya", status: "public", team: "solo", dist: "45m", avatar: "üë©‚Äçü¶±", lvl: 3 },
                { id: 3, name: "Kiran", status: "private", team: "solo", dist: "120m", avatar: "üßë", lvl: 8 }
            ]
        };

        const app = document.getElementById('app');

        function init() {
            setTimeout(() => {
                state.view = 'login';
                render();
            }, 2000);
        }

        function render() {
            app.innerHTML = '';
            
            switch(state.view) {
                case 'login': renderLogin(); break;
                case 'location-select': renderLocationSelect(); break;
                case 'admin': renderAdmin(); break;
                case 'volunteer': renderVolunteer(); break;
                case 'player': renderPlayer(); break;
            }

            if (state.game.active) renderMiniGame();
            if (state.chat.open) renderChatModal();
        }

        // --- LOGIN VIEW ---
        function renderLogin() {
            app.innerHTML = `
                <div class="w-full h-full flex flex-col md:flex-row bg-white relative overflow-hidden">
                    <div class="hidden md:flex md:w-1/2 bg-emerald-600 relative items-center justify-center p-12 overflow-hidden">
                        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        <div class="relative z-10 text-center text-white">
                            <i class="fas fa-compass text-8xl mb-6 animate-float"></i>
                            <h1 class="text-5xl font-bold mb-4">Kerala Quest</h1>
                            <p class="text-emerald-100 text-lg max-w-md mx-auto">Explore God's Own Country like never before. Solve riddles, meet travelers, and unlock the secrets of Kerala.</p>
                        </div>
                    </div>

                    <div class="flex-1 flex flex-col justify-center p-8 md:p-16 relative bg-gray-50">
                        <div class="max-w-md mx-auto w-full">
                            <div class="mb-10 text-center md:text-left">
                                <h2 class="text-3xl font-bold text-gray-800">Welcome Explorer</h2>
                                <p class="text-gray-500 mt-2">Login to start your journey</p>
                            </div>
                            
                            <div class="space-y-4">
                                ${loginButton('player', 'fa-map-marked-alt', 'Start Adventure', 'Find locations & play games', 'emerald')}
                                ${loginButton('volunteer', 'fa-id-badge', 'Volunteer', 'Manage zones & verify', 'blue')}
                                ${loginButton('admin', 'fa-server', 'Admin', 'Control center', 'gray')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loginButton(role, icon, title, sub, color) {
            const colors = {
                emerald: 'bg-emerald-50 text-emerald-600 border-emerald-100 hover:border-emerald-500 hover:bg-emerald-500',
                blue: 'bg-blue-50 text-blue-600 border-blue-100 hover:border-blue-500 hover:bg-blue-500',
                gray: 'bg-gray-100 text-gray-600 border-gray-200 hover:border-gray-800 hover:bg-gray-800'
            };
            return `
                <button onclick="login('${role}')" class="w-full p-5 bg-white border-2 rounded-2xl flex items-center gap-4 shadow-sm transition-all group ${colors[color].replace('bg-', 'hover:text-white ')}">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center text-xl transition-colors ${colors[color]} group-hover:text-white group-hover:bg-white/20">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="text-left flex-1">
                        <h3 class="font-bold text-gray-800 group-hover:text-white transition-colors">${title}</h3>
                        <p class="text-xs text-gray-400 group-hover:text-gray-100 transition-colors">${sub}</p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 group-hover:text-white"></i>
                </button>
            `;
        }

        // --- LOCATION SELECTION FLOW ---
        function renderLocationSelect() {
            if (state.subView === 'permission') {
                app.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full p-8 text-center bg-white">
                        <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center text-blue-500 text-4xl mb-6 animate-pulse">
                            <i class="fas fa-location-dot"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Enable Location</h2>
                        <p class="text-gray-500 mb-8 max-w-xs">We need to know where you are to show games available in your area (Calicut, Kochi, etc).</p>
                        <button onclick="grantPermission()" class="w-full max-w-sm bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition">Allow Access</button>
                        <button onclick="grantPermission()" class="mt-4 text-sm text-gray-400">Select Manually</button>
                    </div>
                `;
            } else {
                app.innerHTML = `
                    <div class="flex flex-col h-full bg-gray-50">
                        <div class="p-6 bg-white shadow-sm z-10">
                            <h2 class="text-xl font-bold text-gray-800">Select Your Zone</h2>
                            <p class="text-sm text-gray-500">Choose a hangout spot to join the game.</p>
                        </div>
                        <div class="flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${HOTSPOTS.map(spot => `
                                <div onclick="selectLocation('${spot.id}')" class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer transform hover:scale-105 transition group">
                                    <div class="h-32 w-full relative" style="background: ${spot.img}">
                                        <div class="absolute bottom-2 left-2 bg-black/20 backdrop-blur px-2 py-1 rounded text-white text-xs font-bold">
                                            <i class="fas fa-map-pin mr-1"></i> ${spot.district}
                                        </div>
                                    </div>
                                    <div class="p-4">
                                        <h3 class="font-bold text-lg text-gray-800 mb-1">${spot.name}</h3>
                                        <p class="text-xs text-gray-500 mb-3">${spot.desc}</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${spot.games.map(g => `<span class="text-[10px] bg-emerald-50 text-emerald-600 px-2 py-1 rounded font-medium">${g}</span>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        // --- PLAYER VIEW ---
        function renderPlayer() {
            let content = '';
            if (state.activeTab === 'home') content = renderPlayerHome();
            else if (state.activeTab === 'social') content = renderPlayerSocial();
            else if (state.activeTab === 'profile') content = renderPlayerProfile();
            else if (state.activeTab === 'leaderboard') content = renderPlayerLeaderboard();

            // Find current location details
            const currentLoc = HOTSPOTS.find(h => h.id === state.user.selectedLocation) || HOTSPOTS[0];

            app.innerHTML = `
                <div class="flex w-full h-full bg-gray-50">
                    <!-- DESKTOP NAV -->
                    <div class="hidden md:flex w-64 bg-white border-r border-gray-100 flex-col shrink-0 z-20">
                        <div class="p-6 flex items-center gap-3">
                            <div class="w-10 h-10 bg-emerald-500 rounded-xl flex items-center justify-center text-white shadow-lg">
                                <i class="fas fa-compass"></i>
                            </div>
                            <span class="font-bold text-gray-800 tracking-tight">Kerala Quest</span>
                        </div>
                        <div class="px-4 py-2">
                            <nav class="space-y-1">
                                ${desktopNavBtn('home', 'fa-compass', 'Quests')}
                                ${desktopNavBtn('social', 'fa-users', 'Mingle')}
                                ${desktopNavBtn('leaderboard', 'fa-trophy', 'Leaderboard')}
                                ${desktopNavBtn('profile', 'fa-user', 'My Profile')}
                            </nav>
                        </div>
                         <div class="mt-auto p-4 border-t border-gray-100">
                             <div class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition" onclick="changeLocation()">
                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-500"><i class="fas fa-map-marker-alt"></i></div>
                                <div>
                                    <div class="text-xs text-gray-400">Current Zone</div>
                                    <div class="text-sm font-bold text-gray-800 truncate w-28">${currentLoc.name}</div>
                                </div>
                                <i class="fas fa-chevron-right text-xs text-gray-400 ml-auto"></i>
                             </div>
                            <button onclick="logout()" class="mt-2 flex items-center gap-3 text-red-500 hover:bg-red-50 transition px-2 py-2 w-full rounded-lg text-sm font-medium">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>

                    <!-- MAIN CONTENT -->
                    <div class="flex-1 flex flex-col h-full relative overflow-hidden">
                        <!-- Header -->
                        <div class="bg-white px-6 pt-12 pb-4 md:py-4 flex justify-between items-center shadow-sm sticky top-0 z-20 border-b border-gray-100">
                            <div>
                                <h2 class="font-bold text-lg text-gray-800">Hi, ${state.user.name} üëã</h2>
                                <button onclick="changeLocation()" class="flex items-center gap-1 text-xs text-gray-500 hover:text-emerald-600 transition">
                                    <i class="fas fa-map-marker-alt text-emerald-500"></i> ${currentLoc.name} <i class="fas fa-chevron-down ml-1 text-[10px]"></i>
                                </button>
                            </div>
                            <div class="flex gap-3">
                                <div class="bg-amber-100 text-amber-700 px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1">
                                    <i class="fas fa-coins"></i> ${state.user.points}
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 overflow-y-auto desktop-scroll bg-gray-50/50 p-0 md:p-8 pb-24 md:pb-8">
                            <div class="max-w-5xl mx-auto">
                                ${content}
                            </div>
                        </div>

                        <!-- Mobile Nav -->
                        <div class="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-100 flex justify-between px-6 py-4 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-30">
                            ${mobileNavBtn('home', 'fa-compass', 'Quest')}
                            ${mobileNavBtn('social', 'fa-users', 'Mingle')}
                            <div class="relative -top-8">
                                <button onclick="startGame()" class="w-14 h-14 rounded-full kerala-gradient flex items-center justify-center text-white shadow-lg shadow-emerald-200 transform hover:scale-105 transition">
                                    <i class="fas fa-play text-xl ml-1"></i>
                                </button>
                            </div>
                            ${mobileNavBtn('leaderboard', 'fa-trophy', 'Rank')}
                            ${mobileNavBtn('profile', 'fa-user', 'Me')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlayerHome() {
            // Get quests for selected location
            const locationQuests = QUESTS[state.user.selectedLocation] || [];
            
            return `
                <div class="p-6 md:p-0 space-y-6">
                    <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-3xl p-6 text-white relative overflow-hidden shadow-lg">
                        <div class="relative z-10">
                            <h3 class="text-2xl font-bold mb-2">Treasure Hunt: Level 1</h3>
                            <p class="text-blue-100 text-sm mb-4">Solve real-world riddles in this location to unlock the next level.</p>
                            <div class="flex items-center gap-4 text-xs font-bold uppercase tracking-wider">
                                <span class="bg-white/20 px-2 py-1 rounded">Offline Mode</span>
                                <span class="bg-emerald-500 px-2 py-1 rounded">AR Ready</span>
                            </div>
                        </div>
                        <i class="fas fa-map absolute -bottom-4 -right-4 text-8xl opacity-10 rotate-12"></i>
                    </div>

                    <!-- Quest List -->
                    <div>
                        <h3 class="font-bold text-gray-800 mb-4 text-lg">Active Missions</h3>
                        <div class="space-y-4">
                            ${locationQuests.map(q => `
                                <div class="bg-white p-6 rounded-2xl shadow-sm border ${q.locked ? 'border-gray-100 opacity-70 grayscale' : 'border-emerald-100'} relative overflow-hidden">
                                    ${q.locked ? '<div class="absolute inset-0 bg-gray-50/50 flex items-center justify-center z-10"><i class="fas fa-lock text-3xl text-gray-400"></i></div>' : ''}
                                    
                                    <div class="flex justify-between mb-2">
                                        <span class="font-bold text-gray-800 text-lg">${q.title}</span>
                                        <span class="text-emerald-600 font-bold text-sm bg-emerald-50 px-2 py-1 rounded">+${q.points} pts</span>
                                    </div>
                                    <p class="text-gray-500 text-sm italic border-l-2 border-emerald-200 pl-3 py-1 my-3 bg-gray-50 rounded-r">"${q.riddle}"</p>
                                    
                                    ${!q.locked ? `
                                        <div class="relative mt-4">
                                            <input type="text" id="questInput_${q.id}" placeholder="Enter the code you found..." 
                                                class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-emerald-500 transition">
                                            <button onclick="checkCode('${q.code}', ${q.id})" class="absolute right-2 top-2 bottom-2 bg-emerald-500 text-white px-4 rounded-lg text-xs font-bold shadow-sm hover:bg-emerald-600 transition">
                                                Unock Next
                                            </button>
                                        </div>
                                    ` : '<div class="h-12"></div>'}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPlayerSocial() {
            const isLooking = state.user.teamStatus === 'looking';

            return `
                <div class="p-6 md:p-0">
                    <!-- Team Finder Toggle -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6 transition-all ${isLooking ? 'ring-2 ring-emerald-400' : ''}">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">
                                    ${isLooking ? '<i class="fas fa-satellite-dish text-emerald-500 animate-pulse"></i> Looking for Team' : 'Start Teaming Up'}
                                </h3>
                                <p class="text-sm text-gray-500 mt-1">${isLooking ? 'Visible to other players nearby.' : 'Find strangers to solve games together.'}</p>
                            </div>
                            <button onclick="toggleTeamStatus()" class="${isLooking ? 'bg-emerald-500 text-white' : 'bg-gray-100 text-gray-500'} px-6 py-3 rounded-xl font-bold transition shadow-sm">
                                ${isLooking ? 'Enabled' : 'Enable'}
                            </button>
                        </div>
                    </div>

                    <h3 class="font-bold text-gray-800 mb-4">Available Players Nearby</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${state.players.map(p => `
                            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition group">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        <div class="w-14 h-14 bg-gray-50 rounded-full flex items-center justify-center text-3xl group-hover:scale-110 transition">${p.avatar}</div>
                                        ${p.team === 'looking' ? '<div class="absolute -top-1 -right-1 bg-emerald-500 text-white text-[10px] px-1.5 py-0.5 rounded-full border-2 border-white font-bold">LFG</div>' : ''}
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800">${p.name}</h4>
                                        <div class="flex items-center gap-2 mt-1">
                                            <span class="px-2 py-0.5 bg-gray-100 rounded text-[10px] font-bold text-gray-500">LVL ${p.lvl}</span>
                                            <span class="text-xs text-gray-400 flex items-center gap-1">
                                                <i class="fas fa-map-pin text-[10px]"></i> ${p.dist}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    ${p.team === 'looking' ? `
                                        <button onclick="alert('Invite sent to ${p.name}')" class="bg-emerald-50 text-emerald-600 w-10 h-10 rounded-xl flex items-center justify-center hover:bg-emerald-600 hover:text-white transition shadow-sm" title="Invite to Team">
                                            <i class="fas fa-user-plus"></i>
                                        </button>
                                    ` : ''}
                                    <button onclick="openChat('${p.name}')" class="bg-blue-50 text-blue-600 w-10 h-10 rounded-xl flex items-center justify-center hover:bg-blue-600 hover:text-white transition shadow-sm">
                                        <i class="fas fa-comment-dots"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // --- ADMIN VIEW ---
        function renderAdmin() {
             app.innerHTML = `
                <div class="flex flex-col h-full bg-gray-100">
                    <div class="bg-gray-900 text-white p-4 sticky top-0 z-20 shadow-lg flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center font-bold text-xl">K</div>
                            <h2 class="font-bold text-lg">Admin Console</h2>
                        </div>
                        <button onclick="logout()" class="text-sm bg-gray-800 px-4 py-2 rounded-lg">Logout</button>
                    </div>
                    <div class="p-8 flex items-center justify-center h-full text-gray-400">Admin Dashboard (See previous versions for full code)</div>
                </div>
            `;
        }
        
        // --- VOLUNTEER VIEW ---
        function renderVolunteer() {
             app.innerHTML = `
                <div class="flex flex-col h-full bg-gray-50">
                    <div class="bg-blue-600 text-white p-6 sticky top-0 z-20 shadow-md flex justify-between">
                        <h2 class="font-bold text-xl">Volunteer Ops</h2>
                        <button onclick="logout()" class="text-sm bg-blue-700 px-4 py-2 rounded-lg">Exit</button>
                    </div>
                     <div class="p-8 flex items-center justify-center h-full text-gray-400">Volunteer Dashboard (See previous versions for full code)</div>
                </div>
            `;
        }
        
        // Helper Components
        function mobileNavBtn(id, icon, label) {
            const active = state.activeTab === id;
            return `<button onclick="switchTab('${id}')" class="flex flex-col items-center gap-1 w-12 ${active ? 'text-emerald-600' : 'text-gray-400'}"><i class="fas ${icon} text-xl"></i><span class="text-[10px] font-medium">${label}</span></button>`;
        }
        function desktopNavBtn(id, icon, label) {
            const active = state.activeTab === id;
            return `<button onclick="switchTab('${id}')" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all ${active ? 'bg-emerald-50 text-emerald-600' : 'text-gray-500 hover:bg-gray-50'}"><i class="fas ${icon} w-5 text-center"></i><span>${label}</span></button>`;
        }
        function renderPlayerProfile() { return `<div class="p-6 text-center text-gray-500">Profile Content (Same as before)</div>`; }
        function renderPlayerLeaderboard() { return `<div class="p-6 text-center text-gray-500">Leaderboard Content (Same as before)</div>`; }

        // --- ACTIONS ---
        function login(role) {
            state.user.role = role;
            if (role === 'player') {
                state.view = 'location-select';
                state.subView = 'permission';
            } else {
                state.view = role;
            }
            render();
        }

        function grantPermission() {
            state.subView = 'list';
            render();
        }

        function selectLocation(id) {
            state.user.selectedLocation = id;
            state.view = 'player';
            state.activeTab = 'home';
            render();
        }

        function changeLocation() {
            state.view = 'location-select';
            state.subView = 'list';
            render();
        }

        function toggleTeamStatus() {
            state.user.teamStatus = state.user.teamStatus === 'solo' ? 'looking' : 'solo';
            render();
        }

        function checkCode(correct, id) {
            const input = document.getElementById(`questInput_${id}`).value.trim().toUpperCase();
            if(input === correct) {
                state.user.points += 500;
                alert(`üéâ Correct! Next level unlocked!`);
                
                // Unlock logic (mock)
                const quests = QUESTS[state.user.selectedLocation];
                const nextQuest = quests.find(q => q.id === id + 1);
                if(nextQuest) nextQuest.locked = false;
                
                render();
            } else {
                alert('‚ùå Incorrect code.');
            }
        }

        function logout() {
            state.view = 'login';
            state.user.role = null;
            render();
        }
        function switchTab(t) { state.activeTab = t; render(); }
        function openChat(n) { alert("Chat with " + n); }
        function startGame() { alert("Mini game!"); }

        init();
    </script>
</body>
</html>
